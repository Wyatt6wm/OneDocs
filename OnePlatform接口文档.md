# OnePlatform接口文档

## 1. 接口规范定义

接口数据格式：JSON。

响应接口规范：

| 字段      | 名称       | 说明                                             |
| --------- | ---------- | ------------------------------------------------ |
| succ      | 处理标志   | true / false，反馈业务层面处理的成功 / 失败。    |
| traceId   | 日志跟踪ID | 调试或出错时用来定位日志进行分析。               |
| data      | 响应数据   | 可选填，成功时返回响应数据。                     |
| data.mesg | 响应信息   | 可选填，成功时返回成功信息，失败时返回失败信息。 |

文档编写约定：对于以下约定的场景，为了精简接口文档篇幅，文档中只列举标题，不再展开接口字段。此时若有`data.mesg`响应信息要返回前端，则其内容同文档标题。

1. 业务处理成功，无需返回数据，可能返回成功信息。
2. 业务处理失败，无需返回数据，可能返回失败信息。

## 2. API接口

### 2.1. oneplatform-system

#### 2.1.1. 获取验证码

- 请求路径：/api/sys/common/getCaptcha
- 请求方法：get
- 请求参数：无
- 权限验证：无
- 响应数据：

##### 获取成功

```json
{
    "succ": true,
    "data": {
        "captchaKey": "验证码KEY",
        "captchaImage": "验证码图片Base64编码"
    }
}
```

#### 2.1.2. 注册用户

- 请求路径：/api/sys/user/registry
- 请求方法：post
- 请求参数

| 参数         | 说明      | 备注                                                         |
| ------------ | --------- | ------------------------------------------------------------ |
| username     | 用户名    | 由大写小写英文、数字组成，长度不大于16位。                   |
| password     | 密码      | 由大写小写英文、数字和特殊字符`.~!@#$%^&*_?`组成，长度6位~16位。明文。 |
| captchaKey   | 验证码KEY | 回传/api/sys/common/getCaptcha接口获取的验证码KEY。          |
| captchaInput | 验证码    |                                                              |

- 权限验证：无
- 响应数据

##### 请求参数错误

##### 用户名格式错误

##### 密码格式错误

##### 验证码格式错误

##### 验证码失效

##### 验证码错误

##### 用户已注册

##### 数据库错误

##### 注册成功

```json
{
	"succ": true
}
```

#### 2.1.3. 登录认证

- 请求路径：/api/sys/user/login
- 请求方法：post
- 请求参数

| 参数         | 说明      | 备注                                                         |
| ------------ | --------- | ------------------------------------------------------------ |
| username     | 用户名    | 由大写小写英文、数字组成，长度不大于16位。                   |
| password     | 密码      | 由大写小写英文、数字和特殊字符`.~!@#$%^&*_?`组成，长度6位~16位。明文。 |
| captchaKey   | 验证码KEY | 回传/api/sys/common/getCaptcha接口获取的验证码KEY。          |
| captchaInput | 验证码    |                                                              |

- 权限验证：无
- 响应数据

##### 请求参数错误

##### 用户名格式错误

##### 密码格式错误

##### 验证码格式错误

##### 验证码失效

##### 验证码错误

##### 数据库错误

##### 用户名或密码错误

##### 认证成功

```json
{
    "succ": true,
    "data": {
        "token": "d8c6ed7a3fd446e4a477b20d1ce9cda0",
        "tokenExpiredTime": "2024-06-01T09:21:53.102+00:00",
        "roles": [
        	"角色1",
            "角色2"
        ],
        "auths": [
            "权限标识符1",
            "权限标识符2"
        ]
    }
}
```

#### 2.1.4. 获取个人信息

- 请求路径：/api/sys/user/getProfile
- 请求方法：get
- 请求参数：无
- 权限验证：已登录
- 响应数据

##### 未登录

##### 获取成功

```json
{
    "succ": true,
    "data": {
        "profile": {
            "userId": 1,
            "username": "用户名",
            "nickname": "昵称",
            "motto": "格言（座右铭）",
            "avatar": "头像地址"
        }
    }
}
```

#### 2.1.5. 退出登录

- 请求路径：/api/sys/user/logout
- 请求方法：get
- 请求参数：无
- 权限验证：已登录
- 响应数据

##### 未登录

##### 退出成功

```json
{
    "succ": true
}
```

#### 2.1.6. 获取用户角色列表

- 请求路径：/api/sys/role/getRoles
- 请求方法：get
- 请求参数：无
- 权限验证：已登录
- 响应数据

##### 未登录

##### 数据库错误

##### 获取角色成功

```json
{
	"succ": true,
    "data": {
        "roles": [
        	"角色1",
            "角色2"
        ] 
    }
}
```

#### 2.1.7. 获取用户权限列表

- 请求路径：/api/sys/auth/getAuths
- 请求方法：get
- 请求参数：无
- 权限验证：已登录
- 响应数据

##### 未登录

##### 数据库错误

##### 获取权限成功

```json
{
	"succ": true,
    "data": {
        "auths": [
        	"权限标识符1",
            "权限标识符2"
        ] 
    }
}
```

#### 2.1.8. 获取用户的权限详细列表

- 请求路径：/api/sys/auth/getAuthDetails
- 请求方法：get
- 请求参数：无
- 权限验证：已登录，super_admin / admin
- 响应数据

##### 未登录

##### 无权限

##### 数据库错误

##### 获取权限详细成功

```json
{
    "succ": true,
    "data": {
        "authDetails": [
            {
                "id": 1,
                "identifier": "view:xxxxx",
                "name": "XXXXX权限",
                "description": "权限说明",
                "activated": true
            },
            {
                "id": 2,
                "identifier": "api:xxxxx",
                "name": "XXXXX权限",
                "description": "权限说明",
                "activated": false
            }
        ]
    }
}
```

#### 2.1.9. 编辑权限

- 请求路径：/api/sys/auth/editAuth
- 请求方法：get
- 请求参数

| 参数        | 说明       | 备注                 |
| ----------- | ---------- | -------------------- |
| id          | 权限ID     | 必填。               |
| identifier  | 权限标识符 | 选填。若空则不修改。 |
| name        | 权限名称   | 选填。若空则不修改。 |
| description | 权限描述   | 选填。若空则不修改。 |
| activated   | 激活标志   | 选填。若空则不修改。 |

- 权限验证：已登录，super_admin
- 响应数据

##### 未登录

##### 无权限

##### 数据库错误

##### 权限ID错误

##### 权限标识符重复

##### 编辑权限成功

```json
{
    "succ": true
}
```

#### 2.1.10. 新增权限

- 请求路径：/api/sys/auth/addAuth
- 请求方法：post
- 请求参数

| 参数        | 说明       | 备注                 |
| ----------- | ---------- | -------------------- |
| identifier  | 权限标识符 | 选填。若空则不修改。 |
| name        | 权限名称   | 选填。若空则不修改。 |
| description | 权限描述   | 选填。若空则不修改。 |
| activated   | 激活标志   | 选填。若空则不修改。 |

- 权限验证：已登录，super_admin
- 响应数据

##### 未登录

##### 无权限

##### 数据库错误

##### 权限标识符重复

##### 新增权限成功

```json
{
	"succ": true
}
```

